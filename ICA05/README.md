# IS105
Brukerscenario 1: 
Du skal ta en dagstur til Kristiansand for å besøke en venn. Du går inn på denne nettsiden for der vet du at du kan finne ut hvordan været er i dag, og finne fram adressen til der vennen din bor. 

Brukerscenario 2:
Du har aldri vært i Kristiansand før, og besøker nettsiden for å finne ut litt mer. Inne på nettsiden ligger det en video om byen, og litt om hvor de forskjellige plassene ligger. Du finner fram til de forskjellig plassene ved å skrive det inn i søkemotoren. I tillegg kan du klikke den videre til å finne hvordan været har vært i det siste. Det gjør du ved å bare trykke på der været står.


![](https://github.com/Daddyslittlegirls/IS105/blob/Andrea/ICA05/Bilder/Nettside%20del%201.png)
![](https://github.com/Daddyslittlegirls/IS105/blob/Andrea/ICA05/Bilder/Nettside%20del%202.png)


### Her er HTML og server.go koden. 

#### HTML

```html
<html>
<body bgcolor="#E0E0E0">
    <h1> {{.Name}}</h1>
    <h2>Oppgave: {{.Description}}</h2>
    <h3>Soloppgang i Kristiansand: {{.Sunrise}}</h3>
    <h3>Solnedgang i Kristiansand: {{.Sunset}}</h3>
    <form action="/">
      <font>Søk google maps: </font><br />
       <input type="text" name="place" placeholder="UIA kristiansand">
        <input type="submit" value="Søk!">
    </form>
     <iframe
            width="50%"
            height="50%"
            frameborder="0" style="border:0"
            src="https://www.google.com/maps/embed/v1/place?key=AIzaSyDxwGLdsYA1zvYqq_HzkoaLNLnr7uE4OII
            &q={{.MapData}}" allowfullscreen>

    </iframe>
    <iframe width="400" height="400" src="https://www.youtube.com/embed/tlgt7ltaDHk" frameborder="0" allowfullscreen>
    </iframe>
    <a href="https://www.accuweather.com/no/no/kristiansand/261324/weather-forecast/261324" class="aw-widget-legal"></a>

  <div id="awcc1491318379494"
    class="aw-widget-current"
    data-locationkey="261324"
    data-unit="c"
    data-language="no"
    data-useip="false"
    data-uid="awcc1491318379494">
  </div>
  <script type="text/javascript" src="https://oap.accuweather.com/launch.js">
  </script>
</body>
</html>
```


#### server.go
Vi bruker Go-templates for å binde sammen viewet(html) med logikken i webapplikasjonen i server.go

```golang
type SiteData struct {
	Name string
	Description string
	Count string
	MapData string
	Sunrise string
	Sunset string
}
```
Hver av disse objektene i `SiteData` er tilgjengelig i HTML'en slik at vi kan gjøre noe med disse før de blir vist i viewet

```golang
func main() {
	m.Get("/", func(r render.Render, x *http.Request) {
		place := string(x.FormValue("place"))
		place = strings.Replace(place, " ", "+", -1)
		if len(place) <= 0 {place = "UIA+Kristiansand"}
    
		r.HTML(200, "index", SiteData{
			"Gruppe 6",
			"ICA05",
			strconv.Itoa(count),
			place,
			getSunrise(),
			getSunset(),
		})
	})
```
Vi bruker deretter `render` objektet i `main()` funksjonen for å mappe funksjoner og HTTP-kall til hver av `SiteData` objektene



```golang
func getSunrise() string {
	req, err := http.NewRequest("GET", "https://api.sunrise-sunset.org/json?lat=58.159912&lng=8.018206", nil)
	if err != nil {
		log.Fatal("NewRequest: ", err)
		return string("ERROR")
	}

	client := &http.Client{}

	resp, err := client.Do(req)
	if err != nil {
		log.Fatal("Do: ", err)
		return string("ERROR")
	}
	defer resp.Body.Close()

	var record AutoGenerated

	if err := json.NewDecoder(resp.Body).Decode(&record); err != nil {
		log.Println(err)
	}

	return string(record.Results.Sunrise);
}
```
Her har vi en funksjon som henter soloppgang og solnedgang basert på en lenge og breddegrad.
Den bruker `import "encoding/json"`-pakken for å decode JSON-rådata;

Vi mapper så denne json-responsen til et go-objekt:

```golang
type AutoGenerated struct {
	Results struct {
		Sunrise string `json:"sunrise"`
		Sunset string `json:"sunset"`
		SolarNoon string `json:"solar_noon"`
		DayLength string `json:"day_length"`
		CivilTwilightBegin string `json:"civil_twilight_begin"`
		CivilTwilightEnd string `json:"civil_twilight_end"`
		NauticalTwilightBegin string `json:"nautical_twilight_begin"`
		NauticalTwilightEnd string `json:"nautical_twilight_end"`
		AstronomicalTwilightBegin string `json:"astronomical_twilight_begin"`
		AstronomicalTwilightEnd string `json:"astronomical_twilight_end"`
	} `json:"results"`
	Status string `json:"status"`
}
```

Koden er lånt av Christian Moens repository: https://github.com/Cmoen11/GoWebExample . 
Vi har noe likt i koden, men det er gjort en del annerleder så vi forstår hva som skjer når vi kjører den. 
